<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="minsung">

	<select id="boardListSelected" resultType="com.project.skyuniversity.minsung.model.MinsungBoardVO">
		select fk_boardKindNo, boardNo, fk_memberNo, subject, regDate, contents1, writerIp, fk_categoryno
		from tbl_board_notice
	</select>
	
 	<select id="boardListSearchWithPaging" parameterType="HashMap" resultType="com.project.skyuniversity.minsung.model.MinsungBoardVO">
		
		select rno, boardNo, fk_boardKindNo, fk_memberNo, nickname as fk_nickname, categoryName as fk_categoryName, subject, regDate, editDate
               , content, readCount, status, writerIp
      from 
      (
          select row_number() over(order by boardno asc)  as rno, boardNo, V.fk_boardKindNo, V.fk_memberNo, M.nickname, C.categoryName, subject
               , to_char(regDate, 'yyyy-mm-dd hh24:mi:ss') as regDate, to_char(editDate, 'yyyy-mm-dd hh24:mi:ss') as editDate
               , content, readCount, status, writerIp
          from tbl_category C join tbl_board_notice V 
          on C.categoryno = V.fk_categoryno
          join tbl_commu_member M 
          on V.fk_memberNo = M.fk_memberNo
          where V.status = 1
          <if test='searchWord != "" '>
            and lower(${searchType}) like '%' || lower(#{searchWord}) || '%'
           </if>
      )T
      where rno between #{startRno} and #{endRno}
      order by rno desc
		
	</select>
	
	
	
	<select id="getTotalCount" parameterType="HashMap" resultType="int">
    	
		select count(*)       
		from tbl_board_notice b join tbl_commu_member m
        on b.fk_memberno = m.fk_memberno
		where status = 1
		<if test='searchWord != ""'>
		and lower(${searchType}) like '%'|| lower(#{searchWord}) ||'%'
		</if>
		
    </select> 
    
    <select id="categoryList" parameterType="String" resultType="com.project.skyuniversity.minsung.model.MinsungCategoryVO">
		select categoryno, fk_boardkindno, CATEGORYNAME
		from TBL_CATEGORY
		where fk_boardkindno = #{boardKindNo}
    </select>
    
    <select id="kindBoard" parameterType="String" resultType="String">
    	select boardname from TBL_BOARDKIND
		where boardkindno = #{boardKindNo}
    </select>
    
    <select id="getOneBoard" parameterType="String" resultType="com.project.skyuniversity.minsung.model.MinsungBoardVO">
		select V.boardNo, V.fk_boardKindNo, V.fk_memberNo, M.nickname as fk_nickname, V.fk_categoryno, C.categoryName as fk_categoryName,
		subject, regDate, editDate, content, readCount, writerIp
		from tbl_category C join tbl_board_notice V 
		on C.categoryno = V.fk_categoryno
		join tbl_commu_member M 
		on V.fk_memberNo = M.fk_memberNo
		where boardno = #{boardNo}
    </select>
    
    <update id="edit" parameterType="com.project.skyuniversity.minsung.model.MinsungBoardVO">
    	update tbl_board_notice set subject = #{subject}
                   , content = #{content}
		where boardNo = #{boardNo}
    </update>
    
    <delete id="del" parameterType="com.project.skyuniversity.minsung.model.MinsungBoardVO">
    	delete from tbl_board_notice
		where boardNo = #{boardNo}
    </delete>
    
    <insert id="add" parameterType="com.project.skyuniversity.minsung.model.MinsungBoardVO">
    
    	insert into tbl_board_notice(fk_boardkindno, boardno, fk_categoryno, fk_memberno, subject, regdate,
    	editdate, content, readcount, status, writerip)
		values(#{fk_boardKindNo}, tbl_boardNotice_seq.nextval, #{fk_categoryNo}, #{fk_memberNo}, #{subject}, sysdate, default, #{content}, default, default, '12-34')

    </insert>
    
    <select id="recentBoardList" resultType="com.project.skyuniversity.minsung.model.MinsungBoardVO">
		select fk_boardKindNo, subject, regDate, boardName, boardNo, status
		from
		(
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_notice b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno)
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_council b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from TBL_BOARD_major b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from TBL_BOARD_club b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from TBL_BOARD_graduate b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_critic b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from TBL_BOARD_study b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from TBL_BOARD_cert b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from TBL_BOARD_emp b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_joboffer b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from TBL_BOARD_lost b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_informal b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_polite b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_humor b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_issue b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_mbti b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_food b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_love b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_hobby b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_health b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, regDate, k.boardname, boardNo, status from tbl_board_diet b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		order by regDate desc
		) V
		where status = 1 and 
		<![CDATA[ rownum <= 5]]> 
    </select>
    
     <select id="bestBoardList" resultType="com.project.skyuniversity.minsung.model.MinsungBoardVO">
		select boardNo, fk_boardKindNo, subject, boardName
		     from
		     ( 
		     select row_number() over(order by upCount desc, readCount desc) as rno, boardNo, fk_boardKindNo, subject, readCount, upCount, boardName
		     from 
		     (
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_NOTICE b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		      
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_COUNCIL b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_MAJOR b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_CLUB b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_GRADUATE b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_CRITIC b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_INFORMAL b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from tbl_board_polite b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_HUMOR b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_ISSUE b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_MBTI b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_FOOD b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_LOVE b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_HOBBY b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_HEALTH b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_DIET b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_STUDY b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_CERT b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_EMP b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     
		     union all
		     
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_JOBOFFER b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     union all
		     select b.boardNo, b.fk_boardKindNo, b.subject, b.readCount, nvl(v.upCount, 0) as upCount, b.status, k.boardName
		     from TBL_BOARD_LOST b
		     left join 
		     (
		         select fk_boardKindNo, fk_boardNo, count(*) as upCount
		         from tbl_board_good
		         group by fk_boardKindNo, fk_boardNo
		     ) v 
		     on b.fk_boardKindNo = v.fk_boardKindNo and b.boardNo = v.fk_boardNo
		     join tbl_boardkind k
		     on b.fk_boardkindno = k.boardkindno
		     ) 
		     where status = 1
		     ) 
		<![CDATA[ where rno <= 5]]>
    </select> 
    
     <select id="popularBoardList" resultType="com.project.skyuniversity.minsung.model.MinsungBoardVO">
		select fk_boardKindNo, subject, readCount, boardName, status
		from
		(
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_notice b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno)
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_council b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from TBL_BOARD_major b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from TBL_BOARD_club b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from TBL_BOARD_graduate b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_critic b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from TBL_BOARD_study b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from TBL_BOARD_cert b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from TBL_BOARD_emp b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_joboffer b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from TBL_BOARD_lost b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_informal b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_polite b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_humor b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_issue b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_mbti b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_food b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_love b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_hobby b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_health b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		union all
		(select fk_boardkindno, subject, readCount, k.boardname, status from tbl_board_diet b
		join tbl_boardkind k on b.fk_boardkindno = k.boardkindno )
		order by readCount desc
		) V 
		where status = 1 and
		<![CDATA[ rownum <= 5]]>
    </select>
    
    <!-- 회원 번호와 포인트를 받아와 회원 포인트를 올려주기 -->
	<update id="pointPlus" parameterType="HashMap">
		update tbl_commu_member set point = point + ${point}
		where fk_memberNo = #{fk_memberNo}
	</update>
	
	<!-- 회원번호로 회원의 포인트와 레벨 등을 불러오기 -->
	<resultMap type="HashMap" id="pointCheck"> <!-- property는 HashMap의 키값이며 column이 컬럼명이다. -->
		<result property="fk_memberNo" column="fk_memberNo" javaType="int" />
		<result property="fk_levelNo" column="fk_levelNo" javaType="int" />
		<result property="currentPoint" column="currentPoint" javaType="int" />
		<result property="nextLevelNo" column="nextLevelNo" javaType="int" />
		<result property="nextLevelPoint" column="nextLevelPoint" javaType="int" />
	</resultMap>
	
	<select id="pointCheck" parameterType="String" resultMap="pointCheck">
		select fk_memberNo, fk_levelNo, point as currentPoint, levelNo as nextLevelNo, levelPoint as nextLevelPoint
		from tbl_commu_member M join tbl_commu_member_level L
		on M.fk_levelNo = (L.levelNo - 1)
		where fk_memberNo = #{fk_memberNo}
	</select>
	
	<!-- 회원의 포인트와 레벨을 올려주기 -->
	<update id="pointPlusWithLevel" parameterType="HashMap">
		update tbl_commu_member set point = point + ${point}, fk_levelNo = ${nextLevelNo}
		where fk_memberNo = #{fk_memberNo}
	</update>

	
</mapper>












